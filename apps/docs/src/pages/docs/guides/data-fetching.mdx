import { DocsLayout } from '@/layouts/docs-layout';

export const config = {
    layout: DocsLayout,
};

export const getMetadata = () => ({
    title: 'Docs | Data Fetching',
    description: 'Learn how to fetch data at build time and runtime in Ecopages',
});

# Data Fetching

Ecopages provides built-in functions for fetching data at build time (for static generation) and at runtime (via API handlers).

## Build-Time Data Fetching

When generating static pages, use these two exported functions to provide data to your components.

### `getStaticProps`
Injects custom props into your page component at build time.

```typescript
import { type GetStaticProps } from '@ecopages/core';

export type PageProps = { title: string; content: string };

export const getStaticProps: GetStaticProps<PageProps> = async ({ pathname }) => {
    // Fetch data from a database, file, or external API
    const data = await fetch('https://api.example.com/page-data').then(res => res.json());

    return {
        props: {
            title: data.title,
            content: data.content,
        },
    };
};

const MyPage: EcoComponent<PageProps> = ({ title, content }) => html`
    <h1>${title}</h1>
    <div>${content}</div>
`;
```

### `getStaticPaths`
Required for dynamic routes (`[param]`). It tells Ecopages which paths should be pre-rendered.

```typescript
import { type GetStaticPaths } from '@ecopages/core';

export const getStaticPaths: GetStaticPaths = async () => {
    const posts = await getAllPosts();
    return {
        paths: posts.map((post) => ({ slug: post.slug })),
    };
};
```

---

## Runtime Data Fetching

For dynamic applications, you can fetch data directly from your client-side scripts or through Ecopages API handlers.

### Fetching from API Handlers
Ecopages API handlers run on the Bun server. They are perfect for proxying requests or interacting with a database.

```typescript
// app.ts
app.get('/api/users/:id', async ({ request, response }) => {
    const user = await db.users.find(request.params.id);
    return response.json(user);
});
```

### Client-Side Fetching
Standard browser `fetch` works as expected inside your `*.script.ts` files or hydrated components (React/Lit).

---

## Best Practices

1. **Direct Calls in Static Functions**: Inside `getStaticProps`, prefer direct function calls (e.g., `db.query()`) rather than calling your own API routes via HTTP to improve build performance.
2. **Type Safety**: Always use the provided TypeScript generics (`GetStaticProps<T>`, `GetStaticPaths<T>`) to ensure your component props are correctly typed throughout the application.
3. **Environment Variables**: Use `import.meta.env` to access API keys and configuration secrets safely.
